<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Financiero</title>
  <style>
    /* Estilos Generales */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f0f2f5;
      color: #1f1f1f;
      margin: 0;
      padding: 20px;
    }

    /* Estilos para las Pesta침as */
    .tab {
      overflow: hidden;
      border-bottom: 1px solid #ccc;
      background-color: #fff;
      max-width: 800px;
      margin: 0 auto;
      border-radius: 8px 8px 0 0;
    }

    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 20px;
      transition: 0.3s;
      font-size: 17px;
      font-weight: 500;
    }

    .tab button:hover {
      background-color: #ddd;
    }

    .tab button.active {
      background-color: #e0e0e0;
      border-bottom: 2px solid #007bff;
    }

    .tabcontent {
      display: none;
      padding: 20px 12px;
      border: 1px solid #ccc;
      border-top: none;
      max-width: 800px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 0 0 8px 8px;
    }
    
    /* --- PESTA칌A 1: PORTAFOLIO --- */
    .stock-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #e0e0e0;
    }
    .stock-item:last-child { border-bottom: none; }
    .stock-info .ticker { font-weight: bold; font-size: 1.1em; }
    .stock-info .name { font-size: 0.9em; color: #666; }
    .stock-price { font-size: 1.1em; font-weight: 500; }
    .stock-change {
      padding: 5px 10px;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      min-width: 70px;
      text-align: center;
    }
    .positive { background-color: #26a69a; } /* Verde */
    .negative { background-color: #ef5350; } /* Rojo */

    /* --- PESTA칌A 2: AN츼LISIS --- */
    .analisis-container {
      text-align: center;
      padding: 20px;
    }
    .analisis-container input {
      padding: 10px;
      margin: 10px;
      width: 200px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .analisis-container button {
      padding: 10px 20px;
      margin-top: 10px;
      font-size: 16px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    .analisis-container button:hover { background: #0056b3; }
    .resultado {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      color: #28a745;
    }
  </style>
</head>
<body>

  <div class="tab">
    <button id="defaultOpen" class="tablinks" onclick="openTab(event, 'Portafolio')">游늳 Portafolio</button>
    <button class="tablinks" onclick="openTab(event, 'Analisis')">游빑 An치lisis</button>
  </div>

  <div id="Portafolio" class="tabcontent">
    <h2>Mi Portafolio</h2>
    <div id="stock-list">
      <div class="loading">Cargando datos...</div>
    </div>
  </div>

  <div id="Analisis" class="tabcontent">
    <div class="analisis-container">
      <h2>An치lisis de Rendimiento</h2>
      <input type="number" id="precioActual" placeholder="Precio Actual">
      <input type="number" id="precioCompra" placeholder="Precio Compra">
      <br>
      <button onclick="calcular()">Calcular</button>
      <div class="resultado" id="resultado"></div>
    </div>
  </div>

  <script>
    // --- L칍GICA GENERAL PARA LAS PESTA칌AS ---
    function openTab(evt, tabName) {
      // Ocultar todos los contenidos
      const tabcontent = document.getElementsByClassName("tabcontent");
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }

      // Quitar la clase "active" de todos los botones
      const tablinks = document.getElementsByClassName("tablinks");
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }

      // Mostrar el contenido de la pesta침a actual y marcar el bot칩n como activo
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }
    // Abrir la primera pesta침a por defecto al cargar la p치gina
    document.getElementById("defaultOpen").click();


    // --- L칍GICA PARA PESTA칌A 1: PORTAFOLIO ---
    const stockList = document.getElementById('stock-list');
    async function fetchStocks() {
      try {
        const response = await fetch('/api/stocks'); // Llama a nuestro backend
        const stocks = await response.json();
        stockList.innerHTML = '';
        stocks.sort((a, b) => b.changePercent - a.changePercent);

        stocks.forEach(stock => {
          const changeClass = stock.changePercent >= 0 ? 'positive' : 'negative';
          const sign = stock.changePercent >= 0 ? '+' : '';
          const stockElement = document.createElement('div');
          stockElement.className = 'stock-item';
          stockElement.innerHTML = `
            <div class="stock-info">
              <div class="ticker">${stock.symbol}</div>
              <div class="name">${stock.symbol}</div>
            </div>
            <div class="stock-price">$${stock.price.toFixed(2)}</div>
            <div class="stock-change ${changeClass}">${sign}${stock.changePercent.toFixed(2)}%</div>
          `;
          stockList.appendChild(stockElement);
        });
      } catch (error) {
        stockList.innerHTML = '<div class="error">No se pudieron cargar los datos.</div>';
        console.error('Error:', error);
      }
    }
    // Cargar los datos del portafolio cuando la p치gina est칠 lista
    fetchStocks();


    // --- L칍GICA PARA PESTA칌A 2: AN츼LISIS ---
    function calcular() {
      const actual = parseFloat(document.getElementById("precioActual").value);
      const compra = parseFloat(document.getElementById("precioCompra").value);

      if (isNaN(actual) || isNaN(compra) || compra === 0) {
        document.getElementById("resultado").innerText = "丘멆잺 Ingresa valores v치lidos.";
        return;
      }

      const porcentaje = ((actual - compra) / compra) * 100;
      document.getElementById("resultado").innerText = "Resultado: " + porcentaje.toFixed(3) + "%";
    }
  </script>

</body>
</html>